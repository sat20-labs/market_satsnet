# BRC20协议集成计划

## 项目概述

本文档详细记录了在 Sat20 Market 平台中增加 BRC20 协议支持的完整实施计划。

**项目信息：**
- 项目名称：Sat20 Market BRC20协议集成
- 实施位置：`app/swap/page.tsx` 及相关文件
- 创建时间：2025年11月11日
- 预计工期：6-8个工作日

## 当前状态分析

### 现有协议架构
当前系统支持两种协议：
- **ordx**: OrdX协议
- **runes**: Runes协议

协议实现位置：
- `app/swap/page.tsx:480-484` - 协议标签定义
- `app/swap/page.tsx:477` - 协议状态管理
- `locales/zh/pages.json:9-10,34-35` - 国际化配置

### 技术架构
- **前端框架**: Next.js 14.2.31 + React 19.1.1
- **UI组件库**: NextUI v2.6.11 + shadcn/ui + Tailwind CSS
- **状态管理**: Zustand + SWR + React Query
- **类型系统**: TypeScript 5.0.4 (严格模式)
- **国际化**: react-i18next

## 实施计划

### 阶段1：基础架构扩展 (1-2天)

#### 任务1.1：协议类型定义扩展
**目标**：建立完整的BRC20协议类型系统
**涉及文件**：
- `types/protocol.ts` - 协议基础类型定义
- `types/brc20.ts` - BRC20专用类型定义
- `domain/protocol/` - 协议领域模型

**实施步骤**：
1. 分析现有ordx和runes协议的类型结构
2. 定义BRC20协议的接口和数据结构
3. 更新协议联合类型，包含brc20选项
4. 确保类型安全和向后兼容性

#### 任务1.2：国际化配置更新
**目标**：完成BRC20协议的中英文翻译
**涉及文件**：
- `locales/zh/pages.json`
- `locales/en/pages.json`

**具体修改**：
```json
// zh/pages.json
"pages": {
  "launchpool": {
    "all": "全部",
    "ordx": "OrdX",
    "runes": "Runes",
    "brc20": "BRC-20"  // 新增
  }
}

// en/pages.json
"pages": {
  "launchpool": {
    "all": "All",
    "ordx": "OrdX",
    "runes": "Runes",
    "brc20": "BRC-20"  // 新增
  }
}
```

#### 任务1.3：协议管理器扩展
**目标**：扩展协议管理系统以支持BRC20
**涉及文件**：
- `store/common.ts` - 协议状态管理
- `lib/hooks/useProtocol.ts` - 协议相关hooks

**实施步骤**：
1. 更新协议状态类型，包含'brc20'选项
2. 扩展协议切换逻辑
3. 添加BRC20协议的默认配置

### 阶段2：swap页面集成 (2-3天)

#### 任务2.1：协议标签页更新
**目标**：在swap页面添加BRC20协议选项
**涉及文件**：`app/swap/page.tsx`

**具体修改**：
```typescript
// 第480-484行
const protocolTabs = [
  { label: t("pages.launchpool.all"), key: "all" },
  { label: t("pages.launchpool.ordx"), key: "ordx" },
  { label: t("pages.launchpool.runes"), key: "runes" },
  { label: t("pages.launchpool.brc20"), key: "brc20" }, // 新增
];

// 第477行
const [protocol, setProtocol] = useState<"all" | "ordx" | "runes" | "brc20">("all");
```

#### 任务2.2：协议过滤逻辑更新
**目标**：确保BRC20资产能正确过滤和显示
**涉及文件**：`app/swap/page.tsx`

**修改位置**：
- 第488-490行：协议过滤逻辑
- 第202-214行：维护中资产检查逻辑

#### 任务2.3：BRC20数据适配
**目标**：适配BRC20资产的数据结构和显示
**涉及文件**：
- `app/swap/page.tsx:82-171` - adaptPoolData函数
- `app/swap/page.tsx:71-80` - getMaxSupply函数

**实施步骤**：
1. 分析BRC20资产的数据结构
2. 更新数据适配逻辑，支持BRC20协议
3. 确保价格计算和市值显示正确

#### 任务2.4：UI显示逻辑优化
**目标**：优化BRC20资产的UI显示效果
**涉及文件**：`app/swap/page.tsx`

**修改位置**：
- 第655-673行：移动端runes协议特殊处理
- 第836-885行：桌面端协议显示逻辑
- 第996-1007行：池子大小显示逻辑

### 阶段3：BRC20特有功能 (2-3天)

#### 任务3.1：BRC20资产信息获取
**目标**：实现BRC20资产的专用数据获取逻辑
**涉及文件**：
- `lib/hooks/useBRC20Assets.ts` - 新建
- `api/brc20.ts` - 新建
- `domain/services/brc20Service.ts` - 新建

**实施步骤**：
1. 集成BRC20数据源API
2. 实现资产信息缓存机制
3. 添加错误处理和重试逻辑

#### 任务3.2：BRC20特有信息展示
**目标**：展示BRC20协议特有的资产信息
**涉及文件**：
- `components/brc20/BRC20AssetInfo.tsx` - 新建
- `components/brc20/BRC20MarketStats.tsx` - 新建

**特有信息**：
- 持有人总数
- 24小时交易量
- 流动性指标
- 铸造进度

#### 任务3.3：BRC20交易功能
**目标**：实现BRC20资产的交易功能
**涉及文件**：
- `hooks/useBRC20Trade.ts` - 新建
- `components/brc20/BRC20TradePanel.tsx` - 新建

### 阶段4：测试和优化 (1天)

#### 任务4.1：功能测试
**测试范围**：
- 协议切换功能
- BRC20资产显示
- 数据加载和刷新
- 移动端和桌面端兼容性

#### 任务4.2：性能优化
**优化目标**：
- 数据加载速度
- 内存使用效率
- 用户交互响应时间

#### 任务4.3：用户验收测试
**验证内容**：
- 用户体验流畅性
- 功能完整性
- 错误处理机制

## 技术决策

### 数据源选择
采用**方案A**：使用现有的Ordinals API作为BRC20数据源
- 优点：与现有架构保持一致，减少额外依赖
- 实现方式：扩展现有的API调用逻辑，添加BRC20特定的数据处理

### UI展示方式
采用**方案A**：与ordx和runes保持相同的卡片式布局
- 优点：界面一致性高，用户学习成本低
- 实现方式：复用现有的组件结构，添加BRC20特定的显示逻辑

### 排序策略
采用**混合方案**：
- 基础排序：与现有协议保持一致（市值、价格等）
- BRC20特色：添加持有人数作为可选排序选项

### 移动端交互
采用**方案A**：使用顶部标签页切换（与现有桌面端一致）
- 优点：交互一致，实现简单
- 优化点：在小屏幕上调整标签样式和布局

## 风险评估

### 技术风险
- **数据兼容性**：BRC20数据结构可能与现有系统不完全兼容
- **性能影响**：新增协议可能影响页面加载性能
- **类型安全**：需要确保新增的BRC20类型不影响现有功能

### 缓解措施
- 充分的数据验证和类型检查
- 渐进式功能开发和测试
- 完善的错误处理和用户反馈机制

## 验收标准

### 功能验收
- [ ] BRC20协议标签正常显示和切换
- [ ] BRC20资产信息正确获取和展示
- [ ] 交易功能正常工作
- [ ] 移动端和桌面端体验一致

### 性能验收
- [ ] 页面加载时间不增加超过20%
- [ ] 内存使用量保持在合理范围
- [ ] 用户交互响应时间<300ms

### 用户体验验收
- [ ] 界面风格与现有设计保持一致
- [ ] 错误提示清晰易懂
- [ ] 操作流程符合用户习惯

## 后续扩展计划

### 短期计划（1个月内）
- 监控BRC20功能的使用情况
- 收集用户反馈并优化
- 修复发现的问题和性能瓶颈

### 长期计划（3个月内）
- 考虑添加其他比特币协议支持
- 优化多协议架构的可扩展性
- 探索跨协议交易功能

---

**文档版本**: v1.0
**最后更新**: 2025年11月11日
**负责人**: 开发团队