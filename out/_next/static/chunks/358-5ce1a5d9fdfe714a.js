"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[358],{5773:function(e,t,a){a.d(t,{T:function(){return p}});var s=a(7437),l=a(9355),r=a(2265),n=a(3514),i=a(4175),o=a(6975);function c(e){var t;let{columns:a,data:l}=e,r=(0,n.b7)({data:l,columns:a,getCoreRowModel:(0,i.sC)()});return(0,s.jsx)("div",{className:"rounded-md border",children:(0,s.jsxs)(o.iA,{children:[(0,s.jsx)(o.xD,{children:r.getHeaderGroups().map(e=>(0,s.jsx)(o.SC,{children:e.headers.map(e=>(0,s.jsx)(o.ss,{className:"bg-zinc-800 text-zinc-400 text-sm font-semibold",children:e.isPlaceholder?null:(0,n.ie)(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),(0,s.jsx)(o.RM,{children:(null===(t=r.getRowModel().rows)||void 0===t?void 0:t.length)?r.getRowModel().rows.map(e=>(0,s.jsx)(o.SC,{"data-state":e.getIsSelected()&&"selected",children:e.getVisibleCells().map(e=>(0,s.jsx)(o.pj,{children:(0,n.ie)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,s.jsx)(o.SC,{children:(0,s.jsx)(o.pj,{colSpan:a.length,className:"h-24 text-center",children:"No results."})})})]})})}var d=a(5033),m=a(6884),u=a(495),x=a(7776),h=a(89);let p=e=>{let{activities:t,isLoading:a,error:n}=e,{t:i}=(0,h.$G)(),[o,p]=(0,r.useState)(!1),g=e=>{e&&(navigator.clipboard.writeText(e),p(!0),setTimeout(()=>p(!1),1500),x.Am.success(i("common.copied_successfully"),{style:{background:"rgba(0, 0, 0, 0.8)",color:"#fff"}}))},f=[{accessorKey:"eventTypeLabel",header:i("common.event"),cell:e=>{let{row:t}=e,a=t.original.eventTypeLabel,l="Sell"===a?"text-[#cc098b] px-1 border border-[#cc098b] rounded-sm":"Buy"===a?"text-green-600 px-1 border border-green-600 bg-gray-800/90 rounded-sm":"text-gray-300";return(0,s.jsx)("span",{className:"px-2 py-1 rounded text-xs font-semibold ".concat(l),children:a})}},{accessorKey:"quantity",header:i("common.quantity"),cell:e=>{let{row:t}=e;return t.original.quantity.toLocaleString()}},{accessorKey:"price",header:i("common.unit_price_sats"),cell:e=>{let{row:t}=e;return Math.round(t.original.price).toLocaleString()+" sats"}},{accessorKey:"totalValue",header:i("common.total_value_sats"),cell:e=>{let{row:t}=e;return Math.round(t.original.totalValue).toLocaleString()+" sats"}},{accessorKey:"from",header:i("common.from"),cell:e=>{let{row:t}=e,a=t.original.from;return a?(0,s.jsxs)("span",{className:"flex items-center justify-start gap-1",children:[(0,s.jsx)("span",{className:"text-zinc-300 font-thin",children:(0,d.NH)(a,5)}),(0,s.jsx)(u.z,{variant:"ghost",size:"icon",onClick:()=>g(a),className:"h-6 w-6 text-zinc-400 cursor-pointer",children:(0,s.jsx)(m.Z,{className:"h-4 w-4"})})]}):(0,s.jsx)("span",{className:"text-zinc-300",children:"-"})}},{accessorKey:"to",header:i("common.to"),cell:e=>{let{row:t}=e,a=t.original.to;return a?(0,s.jsxs)("span",{className:"flex items-center justify-start gap-1",children:[(0,s.jsx)("span",{className:"text-zinc-300 font-thin",children:(0,d.NH)(a,5)}),(0,s.jsx)(u.z,{variant:"ghost",size:"icon",onClick:()=>g(a),className:"h-6 w-6 text-zinc-400 cursor-pointer",children:(0,s.jsx)(m.Z,{className:"h-4 w-4"})})]}):(0,s.jsx)("span",{className:"text-zinc-300",children:"-"})}},{id:"time",header:i("common.time"),cell:e=>{let{row:t}=e,a=t.original;return(0,s.jsxs)("div",{className:"flex items-center justify-start gap-2",children:[a.time,a.txid&&(0,s.jsx)("a",{href:"https://mempool.dev.sat20.org/tx/".concat(a.txid),target:"_blank",rel:"noopener noreferrer","aria-label":i("common.view_transaction"),className:"text-gray-400 hover:text-white",children:(0,s.jsx)(l.JO,{icon:"mdi:open-in-new",className:"text-base"})})]})}}];return a?(0,s.jsx)("div",{className:"text-center p-10",children:i("common.loading_activities")}):n?(0,s.jsxs)("div",{className:"text-center p-10 text-red-500",children:[i("common.error_loading_activities"),": ",n.message]}):(console.log("activities",t),(0,s.jsx)(c,{columns:f,data:t}))}},4728:function(e,t,a){var s=a(7437),l=a(2265),r=a(549),n=a(1552),i=a(3769),o=a(4842),c=a(7517),d=a(7776),m=a(3102),u=a(1647),x=a(495),h=a(3191),p=a(2785);async function g(e,t,a){let{delayMs:s,maxAttempts:l}=a,r=0,n=null;for(;r<l;){r++;try{let a=await e(...t);if(null==a?void 0:a.data)return a.data;n=Error("".concat(e.name," returned successfully but without expected data format on attempt ").concat(r,".")),console.warn(n.message+" Retrying in ".concat(s,"ms..."))}catch(t){n=t,console.warn("Attempt ".concat(r," failed for ").concat(e.name,". Error: ").concat(t,". Retrying in ").concat(s,"ms..."))}if(r>=l){let t="".concat(e.name," failed after ").concat(l," attempts.");throw console.error(t),d.Am.error("Operation failed after multiple retries. Please try again later."),n||Error(t)}await new Promise(e=>setTimeout(e,s))}throw Error("Retry logic failed unexpectedly.")}let f=(e,t)=>{(""===e||/^\d*\.?\d*$/.test(e))&&t(e.length>1&&e.startsWith("0")&&!e.startsWith("0.")?Number(e.substring(1)):""===e?"":Number(e)>=0?Number(e):"")},b=async(e,t,a,s)=>{console.log("Splitting asset ".concat(e," for quantity ").concat(t));let l=await window.sat20.batchSendAssets_SatsNet(e,t,s);if(console.log("splitRes",l),!(null==l?void 0:l.txId))throw d.Am.error("Failed to split asset."),Error("Failed to split asset or txId missing.");let r=l.txId,i=[],o=[];for(let e=0;e<s;e++){let s=e,l="".concat(r,":").concat(s);console.log("Asset split successful. UTXO created: ".concat(l)),o.push(l),console.log("Attempting to fetch UTXO info for ".concat(l,"..."));let c=await g(n.a.getUtxoInfo,[l],{delayMs:2e3,maxAttempts:15});if(!c)throw Error("Failed to fetch UTXO info for ".concat(l," after multiple attempts."));i.push({...c,Price:Number(a)*Number(t)})}return console.log("Successfully fetched UTXO info:",i),[i,o]},v=async(e,t,a,s)=>{var l,r;console.log("Building sell order...");let n=await window.sat20.buildBatchSellOrder_SatsNet(e.map(e=>JSON.stringify(e)),t,a),i=null==n?void 0:null===(l=n.data)||void 0===l?void 0:l.psbt;if(!i)throw d.Am.error("Failed to build the sell order."),Error("Failed to build sell order or PSBT missing.");console.log("Sell order built, signing PSBT..."),d.Am.info("Please sign the transaction in your wallet.");let o=await s.signPsbt(i,{chain:"sat20"});if(!o)throw d.Am.error("Transaction signing failed or was cancelled."),Error("Failed to sign PSBT.");let c=await window.sat20.splitBatchSignedPsbt_SatsNet(o,a);return null==c?void 0:null===(r=c.data)||void 0===r?void 0:r.psbts},N=async(e,t,a)=>{console.log("Submitting signed order...");let s=a.map(e=>({assets_name:t,raw:e}));try{let t=await n.w.submitBatchOrders({address:e,orders:s});if(200===t.code)return console.log("Sell order submitted successfully"),d.Am.success("Sell order submitted successfully!"),!0;{let e=t.message||"Failed to submit sell order";throw console.error("Failed to submit sell order:",e),d.Am.error("Order submission failed: ".concat(e)),Error(e)}}catch(e){return console.error("Error in submitSignedOrder:",e),!1}};t.Z=e=>{let{assetInfo:t,onSellSuccess:a}=e,{loading:n,assets:g}=(0,r.aX)(),{address:j,btcWallet:y}=(0,o.$)(),{network:w}=(0,i.Ee)(),[A,k]=(0,l.useState)(!1),S=(0,h.NL)(),[z,C]=(0,l.useState)(1),[E,M]=(0,l.useState)({availableAmt:0,lockedAmt:0}),[_,T]=(0,l.useState)(null),[P,O]=(0,l.useState)(""),[B,F]=(0,l.useState)(""),U=(0,l.useMemo)(()=>Number(P)*z,[P,z]),I=(0,l.useMemo)(()=>Math.floor(E.availableAmt/Number(P)),[E.availableAmt,P]),R=(0,l.useMemo)(()=>{let e=Number(U),t=Number(B);return e>0&&t>0?e*t:0},[U,B]),q=(0,l.useMemo)(()=>""!==P&&""!==B&&Number(P)>0&&Number(B)>0&&Number(P)<=E.availableAmt&&!n,[P,B,E.availableAmt,n]),L=async()=>{console.log("getAssetAmount",t.assetName);let e=await window.sat20.getAssetAmount_SatsNet(j,t.assetName);M({availableAmt:Number(e.availableAmt),lockedAmt:Number(e.lockedAmt)})};(0,l.useEffect)(()=>{(async()=>{let e=await window.sat20.getTickerInfo(t.assetName);if(null==e?void 0:e.ticker){let{ticker:t}=e;T(JSON.parse(t))}})()},[j,t.assetName]),(0,l.useEffect)(()=>{L()},[j,t.assetName]);let V=async e=>{console.log(await window.sat20.lockUtxo_SatsNet(j,e,"sell")),await L()},K=async()=>{if(!q){console.warn("Sell attempt with invalid input or state."),Number(U)>E.availableAmt?d.Am.error("Insufficient balance."):0>=Number(U)?d.Am.error("Quantity must be positive."):0>=Number(B)&&d.Am.error("Price must be positive.");return}if(!j||!w||!y){console.error("Missing address, network, or wallet connection."),d.Am.error("Wallet not connected or network not selected.");return}k(!0);let e=Number(P),s=Number(B);try{let[l,r]=await b(t.assetName,e,s,z),n=await v(l,j,w,y);if(await N(j,t.assetName,n)){for(let e of(S.invalidateQueries({queryKey:["orders"]}),r))try{await V(e)}catch(t){console.error("Failed to lock UTXO ".concat(e,":"),t),d.Am.error("Order submitted, but failed to lock UTXO ".concat(e,". Please check manually."))}O(""),F(""),C(1),a&&a()}else console.log("Order submission failed.")}catch(e){console.error("Error during sell process:",e),d.Am.error("Sell process failed: ".concat(e.message||"Unknown error"))}finally{k(!1)}},Q=E.availableAmt+E.lockedAmt,X=E.availableAmt,$=n||A,G=(0,l.useMemo)(()=>t.assetName.split(":").pop()||t.assetName,[t.assetName]);return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 mb-6 p-4 bg-zinc-800/50 rounded-lg",children:[t.assetLogo?(0,s.jsx)("img",{src:t.assetLogo,alt:G,className:"w-12 h-12 rounded-full object-cover"}):(0,s.jsx)(u.qE,{className:"w-12 h-12 flex-shrink-0",children:(0,s.jsx)(u.Q5,{className:"text-xl text-gray-300 font-black bg-zinc-800",children:"string"==typeof G?G.slice(0,1).toUpperCase():"?"})}),(0,s.jsxs)("div",{className:"leading-relaxed min-w-0",children:[(0,s.jsx)("p",{className:"text-sm sm:text-base text-zinc-200 font-medium break-all",children:null==_?void 0:_.displayname}),(0,s.jsxs)("p",{className:"text-sm text-gray-400",children:["Your Balance: ",(0,s.jsxs)("span",{className:"ml-2",children:[" ",Q.toLocaleString()]})]})]})]}),(0,s.jsxs)("div",{className:"mb-4 space-y-1.5",children:[(0,s.jsxs)("label",{htmlFor:"sell-quantity",className:"block text-sm text-gray-400 mb-1",children:["Quantity (",null==_?void 0:_.displayname,"):"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(m.I,{id:"sell-quantity",type:"text",inputMode:"decimal",value:P,onChange:e=>{f(e.target.value,O),C(1)},placeholder:"Enter quantity",className:"h-10",min:"0",disabled:$,autoComplete:"off"}),(0,s.jsx)(x.z,{type:"button",variant:"outline",size:"sm",onClick:()=>{n||(O(E.availableAmt),C(1))},className:"h-10 whitespace-nowrap ".concat(n?"opacity-50":""),disabled:n,children:"Max"})]})]}),(0,s.jsxs)("div",{className:"mb-6 space-y-1.5",children:[(0,s.jsxs)("label",{htmlFor:"sell-price",className:"block text-sm text-gray-400 mb-1",children:["Unit Price (sats/",null==_?void 0:_.displayname,"):"]}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)(m.I,{id:"sell-price",type:"text",inputMode:"decimal",value:B,onChange:e=>{f(e.target.value,F)},placeholder:"Enter price per unit",className:"h-10",min:"0",disabled:$,autoComplete:"off"})})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm text-gray-400 mb-1",children:"Repeat :"}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(p.i,{disabled:!P,defaultValue:[1],max:I,min:1,step:1,value:[z],onValueChange:e=>C(e[0])}),(0,s.jsx)("span",{className:"text-sm text-gray-400",children:z})]})]}),(0,s.jsxs)("div",{className:"gap-2 mb-4 bg-zinc-800/50 rounded-lg p-4 min-h-[100px] text-sm",children:[(0,s.jsxs)("p",{className:"flex justify-between gap-1 text-gray-400",children:[(0,s.jsx)("span",{children:"Available Balance: "}),(0,s.jsxs)("span",{className:"gap-1",children:[X.toLocaleString()," "]})]}),!n&&""!==P&&Number(P)>E.availableAmt&&(0,s.jsx)("p",{className:"text-red-500 font-medium mt-2",children:"Insufficient balance."}),""!==P&&0>=Number(P)&&(0,s.jsx)("p",{className:"text-red-500 font-medium mt-2",children:"Quantity must be positive."}),""!==B&&0>=Number(B)&&(0,s.jsx)("p",{className:"text-red-500 font-medium mt-2",children:"Price must be positive."}),R>0&&!$&&(0,s.jsx)("div",{className:"mt-4 pt-4 border-t border-zinc-800",children:(0,s.jsxs)("p",{className:"font-medium text-gray-400",children:["Est. Receive: ",(0,s.jsxs)("span",{className:"font-semibold text-zinc-200",children:[R," sats"]})]})})]}),(0,s.jsx)(c.j,{asChild:!0,children:(0,s.jsx)(x.z,{type:"button",onClick:K,className:"w-full mt-4 text-sm font-semibold transition-all duration-200 ".concat(!q||$?"bg-gray-600 hover:bg-gray-600 cursor-not-allowed opacity-60":"btn-gradient"),disabled:!q||$,size:"lg",children:A?"Processing...":"Sell ".concat(null==_?void 0:_.displayname)})})]})}},4281:function(e,t,a){a.d(t,{$:function(){return v}});var s=a(7437);a(2265);var l=a(2916),r=a(89),n=a(518),i=a(7592),o=a(3550),c=a(2732),d=a(495);function m(e){let{className:t,...a}=e;return(0,s.jsx)("nav",{role:"navigation","aria-label":"pagination","data-slot":"pagination",className:(0,c.cn)("mx-auto flex w-full justify-center",t),...a})}function u(e){let{className:t,...a}=e;return(0,s.jsx)("ul",{"data-slot":"pagination-content",className:(0,c.cn)("flex flex-row items-center gap-1",t),...a})}function x(e){let{...t}=e;return(0,s.jsx)("li",{"data-slot":"pagination-item",...t})}function h(e){let{className:t,isActive:a,size:l="icon",...r}=e;return(0,s.jsx)("a",{"aria-current":a?"page":void 0,"data-slot":"pagination-link","data-active":a,className:(0,c.cn)((0,d.d)({variant:a?"outline":"ghost",size:l}),t),...r})}function p(e){let{className:t,...a}=e;return(0,s.jsxs)(h,{"aria-label":"Go to previous page",size:"default",className:(0,c.cn)("gap-1 px-2.5 sm:pl-2.5",t),...a,children:[(0,s.jsx)(n.Z,{}),(0,s.jsx)("span",{className:"hidden sm:block",children:"Previous"})]})}function g(e){let{className:t,...a}=e;return(0,s.jsxs)(h,{"aria-label":"Go to next page",size:"default",className:(0,c.cn)("gap-1 px-2.5 sm:pr-2.5",t),...a,children:[(0,s.jsx)("span",{className:"hidden sm:block",children:"Next"}),(0,s.jsx)(i.Z,{})]})}function f(e){let{className:t,...a}=e;return(0,s.jsxs)("span",{"aria-hidden":!0,"data-slot":"pagination-ellipsis",className:(0,c.cn)("flex size-9 items-center justify-center",t),...a,children:[(0,s.jsx)(o.Z,{className:"size-4"}),(0,s.jsx)("span",{className:"sr-only",children:"More pages"})]})}var b=a(6294);let v=e=>{let{currentPage:t,totalPages:a,onPageChange:n,pageSize:i,onPageSizeChange:o,availablePageSizes:c,isLoading:d=!1}=e,{t:v}=(0,r.$G)(),N=(0,l.ac)({maxWidth:640})?3:5,j=e=>{d||n(e)};return a<=0?null:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 mt-4",children:[(0,s.jsx)(m,{className:"justify-start flex-grow",children:(0,s.jsxs)(u,{children:[(0,s.jsx)(x,{children:(0,s.jsx)(p,{onClick:()=>{t>1&&!d&&n(t-1)},className:t<=1||d?"pointer-events-none opacity-50":"cursor-pointer"})}),(()=>{let e=[],l=Math.max(1,t-Math.floor(N/2)),r=Math.min(a,l+N-1);l>1&&(e.push((0,s.jsx)(x,{children:(0,s.jsx)(h,{onClick:()=>j(1),isActive:1===t,children:"1"})},1)),l>2&&e.push((0,s.jsx)(x,{children:(0,s.jsx)(f,{})},"start-ellipsis")));for(let a=l;a<=r;a++)e.push((0,s.jsx)(x,{children:(0,s.jsx)(h,{onClick:()=>j(a),isActive:t===a,children:a})},a));return r<a&&(r<a-1&&e.push((0,s.jsx)(x,{children:(0,s.jsx)(f,{})},"end-ellipsis")),e.push((0,s.jsx)(x,{children:(0,s.jsx)(h,{onClick:()=>j(a),isActive:t===a,children:a})},a))),e})(),(0,s.jsx)(x,{children:(0,s.jsx)(g,{onClick:()=>{t<a&&!d&&n(t+1)},className:t>=a||d?"pointer-events-none opacity-50":"cursor-pointer"})})]})}),(0,s.jsxs)("div",{className:"flex items-center gap-2 justify-end mb-4",children:[(0,s.jsx)("span",{className:"text-sm text-gray-400 whitespace-nowrap",children:v("common.items_per_page")}),(0,s.jsxs)(b.Ph,{value:String(i),onValueChange:e=>{d||o(Number(e))},disabled:d,children:[(0,s.jsx)(b.i4,{className:"w-[70px] h-8 text-xs sm:text-sm bg-zinc-800 border-zinc-700 text-gray-300",children:(0,s.jsx)(b.ki,{})}),(0,s.jsx)(b.Bw,{className:"bg-zinc-800 border-zinc-700 text-gray-300",children:c.map(e=>(0,s.jsx)(b.Ql,{value:String(e),className:"text-xs sm:text-sm",children:e},e))})]})]})]})}},3102:function(e,t,a){a.d(t,{I:function(){return r}});var s=a(7437);a(2265);var l=a(2732);function r(e){let{className:t,type:a,...r}=e;return(0,s.jsx)("input",{type:a,"data-slot":"input",className:(0,l.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...r})}},2785:function(e,t,a){a.d(t,{i:function(){return i}});var s=a(7437),l=a(2265),r=a(8302),n=a(2732);function i(e){let{className:t,defaultValue:a,value:i,min:o=0,max:c=100,...d}=e,m=l.useMemo(()=>Array.isArray(i)?i:Array.isArray(a)?a:[o,c],[i,a,o,c]);return(0,s.jsxs)(r.fC,{"data-slot":"slider",defaultValue:a,value:i,min:o,max:c,className:(0,n.cn)("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",t),...d,children:[(0,s.jsx)(r.fQ,{"data-slot":"slider-track",className:(0,n.cn)("bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-1.5 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"),children:(0,s.jsx)(r.e6,{"data-slot":"slider-range",className:(0,n.cn)("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")})}),Array.from({length:m.length},(e,t)=>(0,s.jsx)(r.bU,{"data-slot":"slider-thumb",className:"border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},t))]})}},7517:function(e,t,a){a.d(t,{j:function(){return o}});var s=a(7437),l=a(495),r=a(4842),n=a(2265),i=a(89);let o=e=>{let{children:t,className:a,text:o,asChild:c}=e,{t:d}=(0,i.$G)(),{connected:m,setModalVisible:u}=(0,r.$)(e=>e),x=e=>{u(!0)};return m?(0,s.jsx)(s.Fragment,{children:t}):c?1===n.Children.count(t)&&n.isValidElement(t)?n.cloneElement(t,{onClick:e=>{var a,s;x(e),null===(a=(s=t.props).onClick)||void 0===a||a.call(s,e)},className:a?"".concat(t.props.className||""," ").concat(a).trim():t.props.className}):(console.warn("WalletConnectBus: The `asChild` prop requires a single valid React element child."),null):(0,s.jsx)(l.z,{onClick:()=>u(!0),className:a,children:o||d("buttons.connect")})}}}]);