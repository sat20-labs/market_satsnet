(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[778],{7659:function(e,t,s){Promise.resolve().then(s.bind(s,567))},567:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return G}});var a=s(7437),l=s(6463),r=s(2265),o=s(5355),n=s(7818),i=s(495),c=s(4842),d=s(1552),m=s(5033),u=s(5635);let x=e=>{let{data:t=[]}=e,s=(0,r.useRef)(null),l=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(l.current){var e;e=l.current,t.length&&(e.data(t),e.render())}},[t]),(0,r.useEffect)(()=>{l.current||(l.current=function(e){let s=new u.kL({container:e,autoFit:!0});return s.theme({type:"classicDark"}).data(t,{value:{min:0}}).encode("x","label").encode("y","value").scale("x",{nice:!0}).scale("y",{nice:!0}).axis("x",{labelAutoRotate:!1,title:null}).axis("y",{title:null}),s.interval().encode("x","label").encode("y","volume").style("size",30).style("inset",2).style("maxWidth",10).scale("y",{independent:!0,domainMin:0}).axis("y",{position:"right",line:!1,tick:!1,label:!1,grid:!1}).tooltip(e=>({title:e.label,name:"Valume",value:e.volume?"".concat((0,m.Ay)(e.volume)," btc"):"-"})).tooltip(e=>({color:!1,name:"Sales",value:e.count?e.count:"-"})),s.line().encode("shape","smooth").style({stroke:"#F7931A"}).scale("y",{independent:!0,domainMin:0}).axis("y",{position:"left",grid:!1}).tooltip(e=>({name:"Avg Price",value:e.realValue?"".concat(e.realValue," sat"):"-"})),s.render(),s}(s.current))},[]),(0,a.jsx)("div",{className:"flex-1 max-w-full",ref:s})};var h=s(3769),f=s(3274);function g(e){let{loading:t,children:s,className:l}=e;return(0,a.jsx)("div",{className:"w-full"+l,children:t?(0,a.jsx)("div",{className:"flex justify-center items-center min-h-[30rem]",children:(0,a.jsx)(f.Z,{className:"h-8 w-8 animate-spin"})}):s})}let p=e=>{let{assets_name:t}=e,[s,l]=(0,r.useState)("24h"),{network:n}=(0,c.$)(),{chain:m}=(0,h.Ee)(),u=(0,r.useMemo)(()=>["getAssetsAnalytics",t,m,n],[t,m,n]),{data:f,isLoading:p}=(0,o.a)({queryKey:u,queryFn:()=>d.w.getAssetsAnalytics({assets_name:t})}),v=(0,r.useMemo)(()=>{var e,t,a,l;let r=(null==f?void 0:null===(t=f.data)||void 0===t?void 0:null===(e=t.items_24hours)||void 0===e?void 0:e.filter(Boolean))||[],o=(null==f?void 0:null===(l=f.data)||void 0===l?void 0:null===(a=l.items_30days)||void 0===a?void 0:a.filter(Boolean))||[];return"24h"===s?r:"7d"===s?null==o?void 0:o.slice(-7):"30d"===s?o:[]},[f,s]),b=(0,r.useMemo)(()=>{let e=[];if(!v)return[];for(let l=0;l<v.length;l++){var t,a;let r=v[l],o="24h"===s?r.time:null===(t=r.date)||void 0===t?void 0:t.replace(/^\d{4}-/,""),n=Math.floor(r.avg_price),i=r.volume,c=n;l>0&&(void 0===n||n<=0)&&(n=null===(a=e[l-1])||void 0===a?void 0:a.value);let d=r.order_count;e.push({label:o,value:n,count:d,realValue:c,volume:i})}return e},[v,s]);return(0,r.useMemo)(()=>{let e=0,t=0;if(!v)return[];for(let s of v)s.date&&(e+=s.sat20.order_count,t+=s.sat20.volume);return[{id:"sat20",label:"SAT20Market",count:e,volume:t},{id:"me",label:"Magiceden",count:0,volume:0},{id:"okx",label:"OKX",count:0,volume:0}]},[v]),(0,a.jsx)("div",{className:"p-2  max-w-[100rem]",children:(0,a.jsxs)(g,{loading:p,children:[(0,a.jsx)("div",{className:"flex justify-end items-center mb-4",children:(0,a.jsx)("div",{className:"flex items-center gap-2",children:[{label:"24h",value:"24h"},{label:"7d",value:"7d"},{label:"30d",value:"30d"}].map(e=>(0,a.jsx)(i.z,{variant:s===e.value?"default":"outline",onClick:()=>l(e.value),size:"sm",children:e.label},e.value))})}),"        ",(0,a.jsx)("div",{className:"flex flex-col md:flex-row justify-between items-center gap-2",children:(0,a.jsx)(x,{data:b||[]})})]})})};(0,n.default)(()=>s.e(190).then(s.t.bind(s,1190,23)),{loadableGenerated:{webpack:()=>[1190]},ssr:!1});let v=e=>{let{assets_name:t}=e,s=(0,r.useMemo)(()=>{let e=t.split(":").pop()||t;return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()},[t]);return(0,a.jsxs)("div",{className:"w-full h-full bg-zinc-900 rounded-lg",children:[(0,a.jsxs)("h2",{className:"text-lg font-bold text-zinc-400 ml-4 py-4",children:["Chart for ",s]}),(0,a.jsx)(p,{assets_name:t})]})};var b=s(9355),y=s(3102),j=e=>{let{activeTab:t,onTabChange:s,onRefresh:l,onSettingsChange:o}=e,[n,c]=(0,r.useState)(!1),[d,m]=(0,r.useState)(!1),[u,x]=(0,r.useState)(0);return(0,a.jsxs)("div",{className:"flex items-center justify-between bg-transparent border-b-1 border-zinc-800 pt-6 rounded-t-lg gap-4",children:[(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("button",{className:"text-sm sm:text-base font-medium pb-2 ".concat("takeOrder"===t?"text-blue-500 border-b-2 border-blue-500":"text-gray-400"),onClick:()=>s("takeOrder"),children:"Take Order"}),(0,a.jsx)("button",{className:"text-sm sm:text-base font-medium pb-2 ".concat("makeOrder"===t?"text-blue-500 border-b-2 border-blue-500":"text-gray-400"),onClick:()=>s("makeOrder"),children:"Make Order"})]}),(0,a.jsxs)("div",{className:"flex gap-4 items-center",children:["takeOrder"===t&&(0,a.jsx)("button",{className:"text-gray-400 hover:text-white transition-colors",onClick:()=>c(!0),"aria-label":"Settings",children:(0,a.jsx)(b.JO,{icon:"mdi:tune-vertical-variant",className:"text-lg sm:text-xl"})}),(0,a.jsx)("button",{className:"text-gray-400 hover:text-white transition-colors",onClick:l,"aria-label":"Refresh",children:(0,a.jsx)(b.JO,{icon:"mdi:refresh",className:"text-lg sm:text-xl"})})]}),n&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-80 z-30",children:(0,a.jsxs)("div",{className:"bg-zinc-900 text-zinc-300 p-4 rounded-xl z-40 shadow-2xl transition-transform duration-300 ease-in-out ".concat(window.innerWidth>=640?"absolute top-16 right-4 w-72":"fixed bottom-0 left-2 w-[96%] rounded-t-lg"),children:[(0,a.jsxs)("h3",{className:"flex justify-start items-center text-base font-medium mb-2 gap-1",children:[" ",(0,a.jsx)(b.JO,{icon:"mdi:cog-outline",className:"text-lg sm:text-xl"}),"Settings"]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4 border-t-1 border-zinc-700 pt-2",children:[(0,a.jsx)("label",{className:"text-sm",children:"Show pending transactions"}),(0,a.jsx)("input",{type:"checkbox",checked:d,onChange:e=>m(e.target.checked),className:"toggle-checkbox"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"text-sm",children:"Item price limit"}),(0,a.jsxs)("div",{className:"flex items-center rounded  py-1",children:[(0,a.jsx)(y.I,{type:"number",value:u,onChange:e=>x(Number(e.target.value)),placeholder:"sats",className:"bg-transparent text-sm py-2 text-white w-full outline-none"}),(0,a.jsx)("span",{className:"text-sm text-gray-400 ml-2",children:"sats"})]})]}),(0,a.jsxs)("div",{className:"flex justify-start gap-2",children:[(0,a.jsx)(i.z,{onClick:()=>c(!1),className:"px-4 py-2 text-sm w-1/2",variant:"outline",children:"Cancel"}),(0,a.jsx)(i.z,{onClick:()=>{o({showOngoingTrades:d,maxBidPrice:u}),c(!1)},className:"px-4 py-2 text-sm btn-gradient w-1/2",children:"Save"})]})]})})]})},N=e=>{let{mode:t,onChange:s,disableSell:l=!1,disableBuy:r=!1}=e;return(0,a.jsxs)("div",{className:"inline-flex my-6 rounded-lg overflow-hidden border border-gray-600 w-full",children:[(0,a.jsx)("button",{onClick:()=>!r&&s("buy"),disabled:r,className:"w-full px-4 py-2 text-sm font-medium ".concat("buy"===t?"bg-zinc-600 text-white":"bg-zinc-800 text-zinc-400"," ").concat(r?"cursor-not-allowed":""),children:"Buy"}),(0,a.jsx)("button",{onClick:()=>!l&&s("sell"),disabled:l,className:"w-full px-4 py-2 text-sm font-medium ".concat("sell"===t?l?"bg-zinc-800 text-zinc-500 cursor-not-allowed":"bg-zinc-600 text-white":"bg-zinc-800 text-zinc-400"),children:"Sell"})]})},w=s(9165),k=s(2732);function z(e){let{delayDuration:t=0,...s}=e;return(0,a.jsx)(w.zt,{"data-slot":"tooltip-provider",delayDuration:t,...s})}function _(e){let{...t}=e;return(0,a.jsx)(z,{children:(0,a.jsx)(w.fC,{"data-slot":"tooltip",...t})})}function S(e){let{...t}=e;return(0,a.jsx)(w.xz,{"data-slot":"tooltip-trigger",...t})}function O(e){let{className:t,sideOffset:s=0,children:l,...r}=e;return(0,a.jsx)(w.h_,{children:(0,a.jsxs)(w.VY,{"data-slot":"tooltip-content",sideOffset:s,className:(0,k.cn)("bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",t),...r,children:[l,(0,a.jsx)(w.Eh,{className:"bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}let C=r.memo(function(e){var t,s,l;let{order:r,selected:o,onClick:n,currentWalletAddress:i,isLocked:c=!1,isProcessingLock:d=!1}=e,m=parseInt(null!==(l=null===(t=r.assets)||void 0===t?void 0:t.amount)&&void 0!==l?l:"0",10),u=r.price,x=null===(s=r.assets)||void 0===s?void 0:s.unit_price,h=(r.address||"")===i;r.value;let f=1===r.locked&&!c,g=h||f,p=h?"Your own order.":f?"Locked by another user.":"";return(0,a.jsx)(z,{children:(0,a.jsxs)(_,{children:[(0,a.jsx)(S,{asChild:!0,children:(0,a.jsxs)("div",{className:"grid grid-cols-3 text-xs px-3 w-full py-3 border-b-1 border-zinc-800 cursor-pointer transition relative\n              ".concat(o&&!g?"bg-gray-800/60 text-zinc-200":"bg-transparent hover:bg-gray-800","\n              ").concat(g?"opacity-50 cursor-not-allowed bg-gray-700/20":""," \n              ").concat(d?"animate-pulse":""),onClick:g?void 0:n,children:[(0,a.jsxs)("div",{className:"ml-1 flex items-center text-left justify-start w-full",children:[(0,a.jsx)("input",{type:"checkbox",checked:o,readOnly:!0,disabled:g,className:"form-checkbox h-4 w-4 mr-2 text-zinc-600"}),m.toLocaleString(),h&&(0,a.jsx)("span",{className:"text-red-400",children:"(my)"}),f&&(0,a.jsx)("span",{className:"text-yellow-400",children:"(locked)"})]}),(0,a.jsxs)("div",{className:"flex-1",children:[x.toLocaleString()," ",(0,a.jsx)("span",{className:"text-zinc-400",children:"sats"})]}),(0,a.jsx)("div",{className:"flex-1 text-left",children:(0,a.jsxs)("div",{children:[u,(0,a.jsx)("span",{className:"text-zinc-400",children:" sats"})]})}),(c||f)&&(0,a.jsx)("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:(0,a.jsx)(b.JO,{icon:"mdi:lock",className:"w-4 h-4 lock-icon ".concat(c?"text-blue-500 visible":"text-yellow-500")})})]})}),p&&(0,a.jsx)(O,{children:(0,a.jsx)("p",{children:p})})]})})});var A=e=>{let{selectedOrders:t}=e,s=t.reduce((e,t)=>(console.log("order.quantity:",t.quantity),e+(t.quantity||0)),0),l=t.reduce((e,t)=>e+t.price,0),r=t.length>0?t[0].ticker:void 0,o=Math.floor(.008*l);return(0,a.jsxs)("div",{className:"mt-4 px-3 pt-4 pb-1 bg-zinc-800/60 divide-y text-sm text-zinc-300 divide-zinc-800 rounded-2xl shadow-lg",children:[(0,a.jsx)("div",{className:"flex font-extrabold text-gray-400 mb-2",children:"Order Summary"}),(0,a.jsxs)("div",{className:"mt-2 text-xs text-zinc-400",children:[(0,a.jsxs)("div",{className:"flex justify-between py-1",children:["Total Quantity: ",(0,a.jsxs)("span",{className:"font-medium",children:[s," ",r]})]}),(0,a.jsxs)("div",{className:"flex justify-between py-1",children:["Total Sats: ",(0,a.jsxs)("span",{className:"font-medium",children:[l," sats"]})]}),(0,a.jsxs)("div",{className:"flex justify-between py-2",children:[(0,a.jsx)("span",{children:"Service Fee (0.8%)"}),(0,a.jsxs)("span",{className:"font-medium",children:[o," sats"]})]}),(0,a.jsxs)("div",{className:"flex justify-between py-2",children:[(0,a.jsx)("span",{children:"Network Fee"}),(0,a.jsxs)("span",{className:"font-medium",children:[10," sats"]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between py-2",children:[(0,a.jsx)("span",{children:"You Pay"}),(0,a.jsxs)("span",{className:"flex justify-end font-extrabold gap-1",children:[(0,a.jsx)(b.JO,{icon:"cryptocurrency-color:btc",className:"mr-1 mt-0.5"}),l+o+10," sats"]})]})]})},P=s(3191),B=s(6298),T=s(7517),F=s(5747),M=s(7776),I=s(453);async function E(e){for(let t=1;t<=30;t++){let[s,a]=await (0,F.vU)(d.a.getUtxoInfo)(e);if(!s&&a&&0===a.code&&a.data)return console.log("Successfully fetched UTXO info for ".concat(e," on attempt ").concat(t)),a.data;console.warn("Attempt ".concat(t," failed for UTXO ").concat(e,": ").concat(s||(null==a?void 0:a.msg),". Retrying...")),t<30&&await new Promise(e=>setTimeout(e,2e3))}throw Error("Failed to get UTXO info for ".concat(e," after ").concat(30," attempts."))}var L=e=>{let{assetInfo:t,mode:s,setMode:l}=e,[n,m]=(0,r.useState)([]),[u,x]=(0,r.useState)(0),[g,p]=(0,r.useState)(!1),[v,b]=(0,r.useState)(new Map),{chain:y,network:j}=(0,h.Ee)(),{assets:N}=(0,h.aX)(),{balance:w,getBalance:k}=(0,h.X$)(),{address:z,btcWallet:_}=(0,c.$)(),[S,O]=(0,r.useState)(1),[F,L]=(0,r.useState)(100),[U,q]=(0,r.useState)([]),[D,X]=(0,r.useState)(0),[R,K]=(0,r.useState)(!1),Q=(0,P.NL)(),$=(0,r.useMemo)(()=>["orders",t.assetName,y,j,S,F,s],[t.assetName,S,F,j,y,s]),J=(0,r.useMemo)(()=>(0,I.Ds)({delay:300},async e=>{if(z&&0!==e.length){U.filter(t=>e.includes(t.order_id)).length!==e.length&&console.warn("Some orders to lock were not found in allOrders"),p(!0);try{let t=await d.w.lockBulkOrder({address:z,orderIds:e});if(200===t.code&&t.data){let e=new Map(v),s=[];t.data.forEach(t=>{if(t.raw)e.set(t.order_id,t.raw);else{let e=U.findIndex(e=>e.order_id===t.order_id);-1!==e&&s.push(e)}}),console.log("Updated lockedOrders after lock:",Array.from(e.keys())),b(e),s.length>0&&(m(e=>e.filter(e=>!s.includes(e))),M.Am.error("Some orders are already locked by others"),Q.invalidateQueries({queryKey:$}))}else M.Am.error(t.msg||"Failed to lock orders"),Q.invalidateQueries({queryKey:$})}catch(e){console.error("Lock orders failed:",e),M.Am.error("Failed to lock orders"),Q.invalidateQueries({queryKey:$})}finally{p(!1)}}}),[z,U,v,Q,$]),V=(0,r.useMemo)(()=>(0,I.Ds)({delay:300},async e=>{if(z&&0!==e.length)try{b(t=>{let s=new Map(t);return e.forEach(e=>s.delete(e)),console.log("Updated lockedOrders after unlock:",Array.from(s.keys())),s});let t=await d.w.unlockBulkOrder({address:z,orderIds:e});200!==t.code&&(console.error("Failed to unlock orders:",e),M.Am.error(t.msg||"Failed to unlock orders"))}catch(e){console.error("Unlock orders failed:",e),M.Am.error("Failed to unlock orders")}}),[z,v]);(0,r.useEffect)(()=>{O(1),q([]),X(0),m([]),x(0),b(new Map)},[t.assetName,s]);let{data:H,isLoading:W,isFetching:Z,error:Y,isSuccess:G}=(0,o.a)({queryKey:$,queryFn:()=>(console.log("Fetching orders: page=".concat(S,", size=").concat(F)),d.w.getOrders({offset:(S-1)*F,size:F,sort:1,assets_name:t.assetName,hide_locked:!1})),enabled:!!t.assetName,placeholderData:B.Wk,refetchInterval:2e4,refetchIntervalInBackground:!1,staleTime:2e4});(0,r.useEffect)(()=>{if(G&&(null==H?void 0:H.data)){var e,t;console.log("Processing successful data for page ".concat(S,":"),H);let s=null!==(e=H.data.order_list)&&void 0!==e?e:[],a=null!==(t=H.data.total)&&void 0!==t?t:0;q(e=>{if(1===S)return console.log("Setting orders for page 1"),s;{let t=new Set(e.map(e=>e.order_id)),a=s.filter(e=>!t.has(e.order_id));return console.log("Appending ".concat(a.length," new unique orders for page ").concat(S)),[...e,...a]}}),X(a),K(!1)}},[H,G,S]),(0,r.useEffect)(()=>{Y&&(console.error("Failed to fetch orders:",Y),M.Am.error("Failed to load orders."),K(!1))},[Y]);let ee=(0,r.useMemo)(()=>[...U].filter(e=>e.address!==z).sort((e,t)=>{var s,a;return parseFloat((null===(s=e.assets)||void 0===s?void 0:s.unit_price)||"0")-parseFloat((null===(a=t.assets)||void 0===a?void 0:a.unit_price)||"0")}),[U,z]),et=(0,r.useMemo)(()=>{let e=0,t=0;for(let s of ee){if((e+=s.value)>w.availableAmt)break;t++}return t},[ee,w.availableAmt]),es=(0,r.useCallback)(async e=>{let t=U[e];if(!t||1===t.locked&&!v.has(t.order_id)||t.address===z){console.warn("Clicked on a disabled or invalid order row.");return}let s=t.order_id;m(t=>{let a=t.includes(e),l=a?t.filter(t=>t!==e):[...t,e].sort((e,t)=>e-t);return x(l.length),a?v.has(s)&&V([s]):J([s]),l})},[U,v,J,V,z]),ea=(0,r.useCallback)(e=>{x(e);let t=ee.slice(0,e).map(e=>U.findIndex(t=>t.order_id===e.order_id)).filter(e=>-1!==e).sort((e,t)=>e-t),s=new Set(n.map(e=>{var t;return null===(t=U[e])||void 0===t?void 0:t.order_id})),a=new Set(t.map(e=>{var t;return null===(t=U[e])||void 0===t?void 0:t.order_id})),l=t.map(e=>{var t;return null===(t=U[e])||void 0===t?void 0:t.order_id}).filter(e=>e&&!s.has(e)),r=n.map(e=>{var t;return null===(t=U[e])||void 0===t?void 0:t.order_id}).filter(e=>e&&!a.has(e));m(t),r.length>0&&V(r),l.length>0&&J(l)},[ee,U,n,J,V]),el=(0,r.useMemo)(()=>(0,I.Ds)({delay:200},e=>{ea(e)}),[ea]),er=n.map(e=>U[e]).filter(e=>null!=e),eo=er.reduce((e,t)=>e+t.value,0),en=w.availableAmt>=eo,ei=(0,r.useMemo)(()=>er.map(e=>{var t,s,a,l,r;let o="string"==typeof(null===(t=e.assets)||void 0===t?void 0:t.assets_name)?e.assets.assets_name:(null===(a=e.assets)||void 0===a?void 0:null===(s=a.assets_name)||void 0===s?void 0:s.Ticker)||"Unknown";return{ticker:o,quantity:parseInt(null!==(r=null===(l=e.assets)||void 0===l?void 0:l.amount)&&void 0!==r?r:"0",10),price:e.price,totalSats:e.price}}),[er]),ec=(0,r.useMemo)(()=>ei.reduce((e,t)=>e+t.totalSats,0),[ei]),[ed,em]=(0,r.useState)(!1),eu=async()=>{if(0===er.length){M.Am.warning("No orders selected.");return}em(!0);let e=M.Am.loading("Processing your order..."),a="testnet"===j?"tb1pttjr9292tea2nr28ca9zswgdhz0dasnz6n3v58mtg9cyf9wqr49sv8zjep":"bc1pwdm870vha822ux4084dxsh899apan7ugwj6f4yu9ntzrk7sled7q06ck8a",l=er.map(e=>e.order_id),r=[];try{var o;console.log("Attempting to ensure lock on orders:",l);let n=await d.w.lockBulkOrder({address:z,orderIds:l});if(console.log("Pre-buy lock result:",n),200!==n.code||!n.data)throw Error(n.msg||"Failed to secure lock on selected orders before buying.");let i={},c=[];if(n.data.forEach(e=>{l.includes(e.order_id)&&(e.raw?(i[e.order_id]=e.raw,r.push(e.order_id)):(c.push(e.order_id),console.warn("Order ".concat(e.order_id," lock confirmed but no raw data returned."))))}),r.length!==l.length){let e=l.filter(e=>!r.includes(e));throw console.error("Could not successfully lock all intended orders:",e),r.length>0&&await d.w.unlockBulkOrder({address:z,orderIds:r}).catch(e=>{console.error("Failed to unlock orders after partial lock failure during buy:",e)}),Error("Failed to lock orders: ".concat(e.join(", "),". Please try again."))}let u=[],x=Math.floor(.008*ec),h=await window.sat20.getUtxosWithAsset_SatsNet(z,"::",ec+x+10);console.log("utxoRes",h);let{utxos:f=[]}=h;if(0===f.length){M.Am.error("No valid UTXOs available for this transaction. Please check your wallet.");return}for(let e of f)try{let t=await E(e);u.push({...t})}catch(t){console.error("Failed to fetch UTXO info for: ".concat(e),t),M.Am.error("Failed to fetch UTXO info for: ".concat(e,". Skipping this UTXO."));continue}if(0===u.length){M.Am.error("No valid UTXOs available for this transaction. Please check your wallet.");return}console.log("UTXO infos fetched:",u);let g=Object.values(i),p=await window.sat20.mergeBatchSignedPsbt_SatsNet(g,j);if(console.log("mergeRaw",p),!p.data.psbt)throw Error("Failed to merge PSBTs.");console.log("Finalizing sell order (based on first selected order)...");let v=await window.sat20.finalizeSellOrder_SatsNet(p.data.psbt,u.map(e=>JSON.stringify(e)),z,a,j,x,10);if(console.log("finalizeSellOrder res",v),!v||!v.psbt)throw await d.w.unlockBulkOrder({address:z,orderIds:r}).catch(e=>console.error("Unlock failed in finalizeSellOrder error path:",e)),Error("Failed to finalize sell order.");console.log("Signing PSBT...");let b=await (null==_?void 0:_.signPsbt(v.psbt,{chain:"sat20"}));if(!b)throw await d.w.unlockBulkOrder({address:z,orderIds:r}).catch(e=>console.error("Unlock failed in signPsbt error path:",e)),Error("Failed to sign PSBT.");console.log("PSBT signed."),console.log("Extracting transaction from PSBT...");let N=await (null===(o=window.sat20)||void 0===o?void 0:o.extractTxFromPsbt(b,y));if(!N)throw await d.w.unlockBulkOrder({address:z,orderIds:r}).catch(e=>console.error("Unlock failed in extractTx error path:",e)),Error("Failed to extract transaction from PSBT.");console.log("buyRaw extracted:",N),console.log("Submitting bulk buy order for IDs:",l);let w=await d.w.bulkBuyOrder({address:z,order_ids:l,raw:N});if(console.log("bulkBuyOrder response:",w),200===w.code){for(let t of(M.Am.success("Order placed successfully!",{id:e}),m([]),O(1),f)){let e=await window.sat20.lockUtxo_SatsNet(z,t,"buy");console.log("lockUtxo_SatsNet res",e)}await k(),Q.invalidateQueries({queryKey:["orders",t.assetName,y,j,1,F,s]})}else throw await d.w.unlockBulkOrder({address:z,orderIds:r}).catch(e=>{console.error("Failed to unlock orders after bulk buy failure:",e)}),Error(w.msg||"Failed to place order.")}catch(t){if(console.error("Error during buy order process:",t),M.Am.error("Order failed: ".concat(t.message||"Unknown error"),{id:e}),r.length>0)try{console.log("Attempting to unlock orders due to error:",r),await d.w.unlockBulkOrder({address:z,orderIds:r}),console.log("Orders unlocked successfully after error.")}catch(e){console.error("Failed to automatically unlock orders after error:",e),M.Am.warning("Failed to automatically unlock orders. Please check manually.",{duration:5e3})}b(e=>{let t=new Map(e);return r.forEach(e=>t.delete(e)),t})}finally{em(!1)}},ex=W&&1===S;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"grid grid-cols-3 text-sm font-semibold text-zinc-500 bg-transparent border-b border-zinc-800 px-2 py-3 rounded",children:[(0,a.jsx)("div",{className:"ml-1",children:"Quantity"}),(0,a.jsx)("div",{children:"Price (unit)"}),(0,a.jsx)("div",{children:"Total"})]}),(0,a.jsxs)("div",{className:"space-y-0 max-h-80 text-sm overflow-y-auto pt-2 w-full scrollbar-thin scrollbar-thumb-blue-500 scrollbar-track-gray-200",children:[ex?(0,a.jsx)("div",{className:"text-center py-4",children:"Loading orders..."}):0!==U.length||Z?U.map((e,t)=>(0,a.jsx)(C,{order:e,selected:n.includes(t),onClick:()=>es(t),currentWalletAddress:z,isLocked:v.has(e.order_id),isProcessingLock:g&&n.includes(t)},e.order_id)):(0,a.jsx)("div",{className:"text-center py-4 text-zinc-500",children:"No orders found."}),R&&(0,a.jsxs)("div",{className:"text-center py-2",children:[(0,a.jsx)(f.Z,{className:"h-4 w-4 animate-spin inline-block"})," Loading more..."]})]}),!ex&&!R&&U.length<D&&(0,a.jsxs)(i.z,{variant:"outline",className:"w-full mt-2",onClick:()=>{K(!0),O(e=>e+1)},disabled:Z,children:[Z?(0,a.jsx)(f.Z,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Load More (",U.length," / ",D,")"]}),n.length>0&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm text-zinc-500 mb-2",children:[(0,a.jsxs)("span",{children:["Selected Orders: ",u]}),(0,a.jsxs)("span",{children:["Max: ",et]})]}),(0,a.jsx)("input",{type:"range",min:"1",max:et,step:"1",value:u,onChange:e=>el(Number(e.target.value)),onMouseUp:()=>ea(u),onTouchEnd:()=>ea(u),className:"w-full"})]}),n.length>0&&(0,a.jsx)(A,{selectedOrders:ei}),!en&&n.length>0&&(0,a.jsx)("p",{className:"text-red-500 mt-4 text-xs font-medium",children:"Insufficient BTC balance to take the selected orders."}),(0,a.jsx)(T.j,{asChild:!0,children:(0,a.jsxs)(i.z,{onClick:eu,className:"w-full mt-4 ".concat(0!==n.length&&en?"btn-gradient":""),disabled:0===n.length||!en||ed||Z,children:[(ed||Z&&!R)&&(0,a.jsx)(f.Z,{className:"mr-2 h-4 w-4 animate-spin"}),ed?"Processing...":"buy"===s?"Buy":"Sell"]})})]})},U=s(1647),q=e=>{let{userWallet:t,assetInfo:s}=e;console.log("BuyOrder",s);let[l,o]=(0,r.useState)(""),[n,c]=(0,r.useState)(""),d=Number(l)*Number(n),m=1e8*t.btcBalance,u=Number(m)>=d&&d>0,x=(0,r.useMemo)(()=>s.assetName.split(":").pop()||s.assetName,[s.assetName]);return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-6 p-4 bg-zinc-800/50 rounded-lg",children:[s.assetLogo?(0,a.jsx)("img",{src:s.assetLogo,alt:x,className:"w-12 h-12 rounded-full object-cover"}):(0,a.jsx)(U.qE,{className:"w-12 h-12 flex-shrink-0",children:(0,a.jsx)(U.Q5,{className:"text-xl text-gray-300 font-black bg-zinc-800",children:"string"==typeof x?x.slice(0,1).toUpperCase():"?"})}),(0,a.jsxs)("div",{className:"leading-relaxed",children:[(0,a.jsx)("p",{className:"text-sm sm:text-base text-zinc-200 font-medium",children:x}),(0,a.jsxs)("p",{className:"text-sm text-gray-400",children:["Floor Price: ",(0,a.jsxs)("span",{className:"ml-2",children:[s.floorPrice," sats"]})]})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("label",{className:"block text-sm text-gray-400 mb-1",children:["Quantity to Buy (",x,"):"]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)(y.I,{type:"number",value:l,onChange:e=>o(Number(e.target.value)),placeholder:"Enter quantity",className:"w-full h-10 bg-zinc-800 text-zinc-200 p-2 rounded",min:"0"})})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("label",{className:"block text-sm text-gray-400 mb-1",children:["Unit Price (sats/",x,"):"]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)(y.I,{type:"number",value:n,onChange:e=>c(Number(e.target.value)),placeholder:"Enter price",className:"w-full h-10 bg-zinc-800 text-white p-2 rounded",min:"0"})})]}),(0,a.jsxs)("div",{className:"gap-2 mb-4 bg-zinc-800/50 rounded-lg p-4 min-h-[100px]",children:[" ",(0,a.jsxs)("p",{className:"flex justify-between gap-1 text-sm text-gray-400",children:[(0,a.jsx)("span",{children:"Available BTC Balance: "}),(0,a.jsxs)("span",{className:"flex justify-start gap-1",children:[m.toLocaleString()," sats"]})]}),""!==l&&""!==n&&!u&&(0,a.jsx)("p",{className:"text-red-500 text-sm font-medium mt-2",children:"Insufficient BTC balance or invalid amount/price for this order."}),l&&n&&d>0&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-zinc-800",children:[" ",(0,a.jsxs)("p",{className:"flex justify-between font-medium text-gray-400",children:[(0,a.jsx)("span",{className:"text-lg",children:"You will pay:"}),(0,a.jsxs)("span",{className:"flex justify-start gap-1 text-gray-200 text-lg font-mono font-bold",children:[d/1e8," BTC"]})]}),(0,a.jsxs)("p",{className:"flex justify-end text-gray-400 text-xs",children:[" ",d.toLocaleString()," sats"]})]})]}),(0,a.jsx)(T.j,{asChild:!0,children:(0,a.jsxs)(i.z,{className:"w-full h-10 mt-4 py-3 rounded-xl text-zinc-200 text-sm font-semibold ".concat(u?"btn-gradient":"bg-gray-700 cursor-not-allowed"),disabled:!u,children:["Buy ",x]})})]})},D=s(4728),X=e=>{let{assetData:t}=e,[s,l]=(0,r.useState)("takeOrder"),[o,n]=(0,r.useState)("buy"),{getBalance:i,balance:c}=(0,h.X$)(),d=(0,r.useMemo)(()=>{let e=(0,m.Ay)(c.availableAmt);return(0,m.xp)(e)},[c]),u={btcBalance:"string"==typeof d?parseFloat(d):d||0,assetBalance:1e3,address:""},[x,f]=(0,r.useState)({showOngoingTrades:!1,maxBidPrice:0});return(0,a.jsxs)("div",{className:"max-w-full mx-auto p-4 bg-[#0E0E10] text-zinc-200 rounded-2xl shadow-lg border border-zinc-700 w-full h-full",children:[(0,a.jsx)(j,{activeTab:s,onTabChange:e=>{l(e),"makeOrder"===e?n("sell"):"takeOrder"===e&&n("buy")},onRefresh:()=>console.log("Refreshing order book..."),onSettingsChange:e=>{f(e),console.log("Updated Settings:",e)}}),"takeOrder"===s?(0,a.jsx)(N,{mode:o,onChange:n,disableSell:!0}):(0,a.jsx)(N,{mode:o,onChange:n,disableBuy:!1}),"takeOrder"===s?(0,a.jsx)(L,{mode:o,setMode:n,assetInfo:{assetLogo:t.assetLogo,assetName:t.assetName,AssetId:t.assetId,floorPrice:parseFloat(t.floorPrice)}}):(0,a.jsx)("div",{children:"buy"===o?(0,a.jsx)(q,{userWallet:u,assetInfo:{assetLogo:t.assetLogo,assetName:t.assetName,AssetId:t.assetId,floorPrice:parseFloat(t.floorPrice)}}):(0,a.jsx)(D.Z,{assetInfo:{assetLogo:t.assetLogo,assetName:t.assetName,AssetId:t.assetId,floorPrice:parseFloat(t.floorPrice)}})}),(0,a.jsxs)("div",{className:"mt-4 text-sm text-gray-400",children:[x.showOngoingTrades&&(0,a.jsx)("p",{children:"Show pending transactions..."}),x.maxBidPrice>0&&(0,a.jsxs)("p",{children:["Item price limit: ",x.maxBidPrice," sats"]})]})]})},R=s(1698);let K=e=>{let{assetData:t}=e,s=t.volume?Number(t.volume)/1e8:0,l=t.marketCap?Number(t.marketCap)/1e8:0,r=t.volume?(0,a.jsx)(R.H,{btc:s}):0,o=t.marketCap?(0,a.jsx)(R.H,{btc:l}):0,n=t.mintProgress?t.mintProgress:"100%";return(0,a.jsxs)("div",{className:"bg-zinc-900 p-5 rounded-lg w-full h-64 sm:h-52",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 sm:mt-4 text-left",children:[(0,a.jsxs)("div",{className:"border-r-1 border-b-1 sm:border-b-0 border-zinc-800 pr-4",children:[(0,a.jsx)("span",{className:"text-gray-400 text-sm",children:"Volume (24H):"}),(0,a.jsxs)("p",{className:"text-white text-lg font-bold",children:[s," ",(0,a.jsx)("span",{className:"text-zinc-400",children:"BTC"})]}),(0,a.jsxs)("p",{className:"text-gray-400 text-xs mb-3",children:["$",r]})]}),(0,a.jsxs)("div",{className:"sm:border-r-1 border-b-1 sm:border-b-0 sm:border-zinc-800 pr-4",children:[(0,a.jsx)("span",{className:"text-gray-400 text-sm",children:"Market Cap:"}),(0,a.jsxs)("p",{className:"text-white text-lg font-bold",children:[l.toLocaleString()," ",(0,a.jsx)("span",{className:"text-zinc-400",children:"BTC"})]}),(0,a.jsxs)("p",{className:"text-gray-400 text-xs",children:["$",o]})]}),(0,a.jsxs)("div",{className:"border-r-1 border-zinc-800 pr-4",children:[(0,a.jsx)("span",{className:"text-gray-400 text-sm",children:"Transactions:"}),(0,a.jsx)("p",{className:"text-white text-lg font-bold",children:t.transactions.toLocaleString()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-400 text-sm",children:"Holders:"}),(0,a.jsx)("p",{className:"text-white text-lg font-bold",children:t.holders.toLocaleString()})]})]}),(0,a.jsxs)("div",{className:"mt-4 mb-2",children:[(0,a.jsx)("span",{className:"text-gray-400 text-sm",children:"Mint Progress"}),(0,a.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-2 mt-2",children:(0,a.jsx)("div",{className:"bg-green-500 h-2 rounded-full",style:{width:t.mintProgress}})}),(0,a.jsx)("p",{className:"text-white text-sm mt-1 text-center",children:n})]})]})};var Q=s(7113),$=s(6294),J=s(89),V=s(5773),H=s(4281);let W=[10,20,50,100],Z=e=>{var t,s,l;let{assets_name:n}=e,{t:m}=(0,J.$G)(),{chain:u}=(0,h.Ee)(),{address:x}=(0,c.$)(),[f,g]=(0,r.useState)(1),[p,v]=(0,r.useState)(20),[y,j]=(0,r.useState)(1),[N,w]=(0,r.useState)(0),[k,z]=(0,r.useState)("activities"),_=(0,r.useMemo)(()=>{let e=[{label:m("common.filter_all"),value:0},{label:m("common.executed"),value:1},{label:m("common.delist"),value:2},{label:m("common.invalid"),value:3},{label:m("common.list"),value:4}];if(x){let t=e.findIndex(e=>1===e.value);t>-1&&e.splice(t,1),e.push({label:m("common.history_sell"),value:10}),e.push({label:m("common.history_buy"),value:11})}return e.sort((e,t)=>e.value-t.value),e},[m,x]),S=(0,o.a)({queryKey:["history",n,f,p,y,N,u,"all"],queryFn:()=>d.w.getHistory({offset:(f-1)*p,size:p,assets_name:n,sort:y,filter:0===N?void 0:N}),enabled:!!n&&"activities"===k,refetchInterval:1e4,refetchIntervalInBackground:!1,staleTime:1e4}),O=(0,o.a)({queryKey:["history",n,f,p,y,N,u,"my",x],queryFn:()=>d.w.getHistory({offset:(f-1)*p,size:p,assets_name:n,sort:y,filter:0===N?void 0:N,address:x}),enabled:!!n&&!!x&&"myActivities"===k}),C=e=>e.map(e=>{try{let t=Number(e.assets.amount),s=Number(e.assets.unit_price);if(isNaN(t)||isNaN(s))return console.warn("Skipping order ".concat(e.order_id,": Invalid quantity or price")),null;let a=e.txid?e.txtime:e.order_time,l=(0,Q.D)(new Date(a),{addSuffix:!0}),r=m("common.unknown"),o=e.result;x&&1===e.result?o=e.address===x?1===e.order_type?10:11:e.txaddress===x?1===e.order_type?11:10:1:void 0===e.result||null===e.result?o=4:0===e.result&&(o=4);let n=_.find(e=>e.value===o);r=n?n.label:"".concat(m("common.unknown")," (").concat(o,")");let i=e.address,c=e.txaddress;return{order_id:e.order_id,eventTypeLabel:r,quantity:t,price:s,totalValue:t*s,time:l,txid:e.txid||void 0,from:i,to:c}}catch(t){return console.error("Error transforming order ".concat(e.order_id,":"),e,t),null}}).filter(e=>null!==e),A="activities"===k?S:O,P=(0,r.useMemo)(()=>{var e,t;return(null===(t=A.data)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.order_list)?C(A.data.data.order_list):[]},[A.data]),B=null!==(l=null===(s=A.data)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.total)&&void 0!==l?l:0,T=(0,r.useMemo)(()=>0===B?1:Math.ceil(B/p),[B,p]);return(0,a.jsxs)("div",{className:"bg-zinc-900/90 sm:p-6 rounded-lg text-zinc-200 w-full",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 px-1 sm:gap-4 mb-4 mt-4",children:[(0,a.jsxs)("div",{className:"flex gap-1 w-full sm:w-auto",children:[(0,a.jsx)(i.z,{variant:"ghost",className:"text-sm sm:text-base font-medium h-auto px-3 py-1.5 ".concat("activities"===k?"text-blue-500 border-b-2 border-blue-500 rounded-none":"text-gray-400 border-b-2 border-transparent rounded-none"),onClick:()=>z("activities"),children:m("common.activity")}),(0,a.jsx)(i.z,{variant:"ghost",className:"text-sm sm:text-base font-medium h-auto px-3 py-1.5 ".concat("myActivities"===k?"text-blue-500 border-b-2 border-blue-500 rounded-none":"text-gray-400 border-b-2 border-transparent rounded-none"),onClick:()=>z("myActivities"),disabled:!x,children:m("common.my_activities")})]}),(0,a.jsxs)("div",{className:"flex flex-wrap sm:flex-nowrap gap-2 sm:gap-4 items-center",children:[(0,a.jsxs)($.Ph,{value:String(N),onValueChange:e=>w(Number(e)),children:[(0,a.jsx)($.i4,{className:"w-[150px] bg-zinc-800 border-zinc-700 text-gray-300 h-8 text-xs sm:text-sm",children:(0,a.jsx)($.ki,{placeholder:m("common.filter_placeholder")})}),(0,a.jsx)($.Bw,{className:"bg-zinc-800 border-zinc-700 text-gray-300",children:_.map(e=>(0,a.jsx)($.Ql,{value:String(e.value),className:"text-xs sm:text-sm",children:e.label},e.value))})]}),(0,a.jsx)(i.z,{variant:"ghost",size:"icon",className:"text-gray-400 hover:text-white transition-colors h-8 w-8","aria-label":m("common.refresh"),onClick:()=>{A.refetch()},children:(0,a.jsx)(b.JO,{icon:"mdi:refresh",className:"h-5 w-5"})})]})]}),"myActivities"!==k||x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(V.T,{activities:P,isLoading:A.isLoading,error:A.error})}),B>0&&(0,a.jsx)(H.$,{currentPage:f,totalPages:T,onPageChange:g,pageSize:p,onPageSizeChange:e=>{v(e),g(1)},availablePageSizes:W,isLoading:A.isLoading})]}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-10 gap-4",children:[(0,a.jsx)("p",{className:"text-gray-400",children:m("common.connect_wallet_to_view")}),(0,a.jsx)(i.z,{variant:"outline",onClick:()=>{},children:m("common.connect_wallet")})]})]})};function Y(e){let{asset:t,assetData:s}=e;return console.log("SatoshiNetMarket assetData:",s),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 sm:gap-6 sm:p-4 h-full w-ful",children:[(0,a.jsxs)("div",{className:"sm:col-span-2 flex flex-col gap-4 mb-8 sm:mb-0",children:[(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[300px] sm:min-h-[680px] sm:mb-0",children:(0,a.jsx)(v,{assets_name:t||""})}),(0,a.jsx)("div",{className:"flex items-center justify-center w-full h-[210px] sm:h-[220px] mt-7 sm:mt-1 sm:mb-0",children:(0,a.jsx)(K,{assetData:s})})]}),(0,a.jsx)("div",{className:"sm:col-span-1 flex items-center justify-center mb-4 mt-3 sm:mb-0 sm:mt-0",children:(0,a.jsx)(X,{assetData:s})}),(0,a.jsx)("div",{className:"col-span-1 sm:col-span-3 flex items-center justify-center w-full",children:(0,a.jsx)(Z,{assets_name:t})})]})}function G(){let e=(0,l.useSearchParams)();(0,l.useRouter)();let t=e.get("asset"),{data:s,isLoading:n,error:i}=(0,o.a)({queryKey:["assetSummary",t],queryFn:()=>d.w.getAssetsSummary({assets_name:null!=t?t:""}),enabled:!!t}),c=(0,r.useMemo)(()=>{var e,t,a,l,r,o,n,i,c,d,m,u,x,h,f,g;let p=null==s?void 0:null===(e=s.data)||void 0===e?void 0:e.summary;return p?{protocol:null!==(n=null===(t=p.assets_name)||void 0===t?void 0:t.Protocol)&&void 0!==n?n:"N/A",nickname:p.nickname||"N/A",assetName:"".concat(null===(a=p.assets_name)||void 0===a?void 0:a.Protocol,":").concat(null===(l=p.assets_name)||void 0===l?void 0:l.Type,":").concat(null===(r=p.assets_name)||void 0===r?void 0:r.Ticker),assetSymbol:null!==(i=null===(o=p.assets_name)||void 0===o?void 0:o.Ticker)&&void 0!==i?i:"N/A",assetDescription:null!==(c=p.description)&&void 0!==c?c:"",assetLogo:null!==(d=p.logo)&&void 0!==d?d:"",floorPrice:null!==(m=p.lowest_price)&&void 0!==m?m:0,price:null!==(u=p.lowest_price)&&void 0!==u?u:0,volume:null!==(x=p.tx_total_volume)&&void 0!==x?x:0,marketCap:null===p.market_cap?null:null!==(h=p.market_cap)&&void 0!==h?h:0,holders:null!==(f=p.holder_count)&&void 0!==f?f:0,transactions:null!==(g=p.tx_order_count)&&void 0!==g?g:0}:{}},[s]);return t?n?(0,a.jsx)("div",{className:"p-4 bg-black text-white w-full",children:"Loading..."}):i?(0,a.jsxs)("div",{className:"p-4 bg-black text-white w-full",children:["Error loading data: ",i.message]}):(0,a.jsx)("div",{className:"p-4 bg-black text-white w-full",children:(0,a.jsx)(Y,{asset:t,assetData:c})}):(0,a.jsx)("div",{className:"p-4 bg-black text-white w-full",children:"Asset parameter missing."})}}},function(e){e.O(0,[508,695,280,42,951,630,327,4,115,358,971,23,744],function(){return e(e.s=7659)}),_N_E=e.O()}]);